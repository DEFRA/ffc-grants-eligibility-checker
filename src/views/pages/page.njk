{% extends 'layout.njk' %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "pages/components/macro.njk" import multiSideBar,
conditionalButtons %}
{% set items = meta.items %}
{% set sidebar = meta.sidebar %}

{% block pageTitle %}
  {% if errorList %}
    Error:
  {% endif %}
  {{ pageTitle }}
{% endblock %}

{% block beforeContent %}
  {% if meta.previousPageId %}
    {{ govukBackLink({
      id: "backLink",
      text: "Back",
      href: meta.previousPageId
    }) }}
  {% endif %}
  {% if errorList %}
    {{ govukErrorSummary ({
        "titleText": "There is a problem",
        "errorList": errorList
      }) }}
  {% endif %}
{% endblock %}

{% block content %}
  <div id="content" class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds govuk-!-margin-top-2">
      <form id="questionForm" onsubmit="handleSubmit(event)" novalidate="novalidate">
        {% if meta.questionType ==='radio' %}
          {{ govukRadios(items) }}
        {% endif %}
        {{ conditionalButtons('Continue') }}
      </form>
    </div>
    {% if sidebar %}
      {{ multiSideBar(sidebar) }}
    {% endif %}
  </div>
  <script>
    function handleSubmit(event) {
      event.preventDefault();
      const form = document.getElementById("questionForm");
      const formData = new FormData(form);

      const url = "/eligibility-checker/{{ meta.grantTypeId }}/transition";
      const data = { event: "NEXT", currentPageId: "{{ meta.currentPageId }}" , nextPageId: "{{ meta.nextPageId }}", previousPageId: "{{ meta.previousPageId }}", answer: formData.get("{{ meta.currentPageId }}") };

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        window.location.href = `/eligibility-checker/{{ meta.grantTypeId }}/${data.nextPageId}`;
      })
      .catch(error => {
        // Handle any errors here
        console.error(error);
      });
    }
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector(".govuk-back-link").addEventListener("click", (event) => {
      fetch("/eligibility-checker/{{ meta.grantTypeId }}/transition", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ event: "BACK", nextPageId: "{{ meta.nextPageId }}", previousPageId: "{{ meta.previousPageId }}" }),
        })
      });
    });
  </script>
{% endblock %}